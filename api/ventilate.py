"""
Vercel Serverless Function: –ü—Ä–æ–≤–µ—Ç—Ä–∏—Ç—å —á–∞—Ç
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞–±—Å—É—Ä–¥–Ω—ã—Ö –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä—Ç–æ—á–∫–∏
"""
import json
import os
import random
from http.server import BaseHTTPRequestHandler
import urllib.request
import urllib.error


AI_GATEWAY_URL = "https://ai-gateway.vercel.sh/v1/messages"

# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
EVENT_CATEGORIES = [
    "–ñ–ò–í–û–¢–ù–´–ï: –≥–æ–ª—É–±—å, –≤–æ—Ä–æ–Ω–∞, –≤–æ—Ä–æ–±–µ–π, —á–∞–π–∫–∞, –ª–µ—Ç—É—á–∞—è –º—ã—à—å, –ø—á—ë–ª—ã, –æ—Å–∞, –∫–æ–º–∞—Ä—ã, –º—É—Ö–∞, —Ç–∞—Ä–∞–∫–∞–Ω, –∫—Ä—ã—Å–∞, –∫–æ—Ç —Å —É–ª–∏—Ü—ã, –±–µ–∑–¥–æ–º–Ω–∞—è —Å–æ–±–∞–∫–∞, –±–µ–ª–∫–∞",
    "–ü–û–ì–û–î–ê: –≤–µ—Ç–µ—Ä —É—Ä–∞–≥–∞–Ω–Ω—ã–π, —Å–∫–≤–æ–∑–Ω—è–∫ –∞–¥—Å–∫–∏–π, –º–æ—Ä–æ–∑ -30, –∂–∞—Ä–∞ +40, –¥–æ–∂–¥—å –∫–æ—Å–æ–π, —Å–Ω–µ–≥, –≥—Ä–∞–¥, –ø—ã–ª—å–Ω–∞—è –±—É—Ä—è, —Å–º–æ–≥, —Ç—É–º–∞–Ω",
    "–ü–†–ï–î–ú–ï–¢–´ –ó–ê–õ–ï–¢–ï–õ–ò: –ø–∞–∫–µ—Ç –∏–∑ –ü—è—Ç—ë—Ä–æ—á–∫–∏, –≥–∞–∑–µ—Ç–∞ 2003 –≥–æ–¥–∞, —á–µ–π-—Ç–æ –Ω–æ—Å–æ–∫, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–µ–∑–µ—Ä–≤–∞—Ç–∏–≤, –ª–∏—Å—Ç–æ–≤–∫–∞ –°–≤–∏–¥–µ—Ç–µ–ª–µ–π –ò–µ–≥–æ–≤—ã, –∫–∏—Ä–ø–∏—á, –æ–∫—É—Ä–æ–∫, —à–∞—Ä–∏–∫ –≤–æ–∑–¥—É—à–Ω—ã–π, –æ–±—ä—è–≤–ª–µ–Ω–∏–µ '—Å–¥–∞–º –∫–≤–∞—Ä—Ç–∏—Ä—É'",
    "–ü–†–ï–î–ú–ï–¢–´ –£–õ–ï–¢–ï–õ–ò: –ø–∞—Ä–∏–∫, –Ω–∞–¥–µ–∂–¥—ã, —á—É–≤—Å—Ç–≤–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞, –¥–µ–Ω—å–≥–∏ –∏–∑ –∫–æ—à–µ–ª—å–∫–∞, –≤–∞–∂–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç, —Ç—Ä—É—Å—ã —Å –±–∞–ª–∫–æ–Ω–∞",
    "–°–û–°–ï–î–ò: –±–∞–±–∫–∞ —Å–Ω–∏–∑—É –Ω–∞—á–∞–ª–∞ –æ—Ä–∞—Ç—å, —Å–æ—Å–µ–¥ —Å –ø–µ—Ä—Ñ–æ—Ä–∞—Ç–æ—Ä–æ–º –∞–∫—Ç–∏–≤–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è, –º—É–∑—ã–∫–∞ –∏–∑ –º–∞—à–∏–Ω—ã –≤–æ –¥–≤–æ—Ä–µ, —á–µ–π-—Ç–æ —Ä–µ–±—ë–Ω–æ–∫ –∑–∞–æ—Ä–∞–ª, —Å–æ–±–∞–∫–∞ –∑–∞–ª–∞—è–ª–∞",
    "–ú–ò–°–¢–ò–ö–ê: –ø—Ä–∏–∑—Ä–∞–∫ –±—ã–≤—à–µ–≥–æ, –¥—É—Ö –ø–æ—Ö–º–µ–ª—å—è, —Ç–µ–Ω—å –æ—Ç—Ü–∞, —Ö–æ–ª–æ–¥ –º–æ–≥–∏–ª—å–Ω—ã–π, –∑–∞–ø–∞—Ö —Å–µ—Ä—ã, –≥–æ–ª–æ—Å —Å —Ç–æ–≥–æ —Å–≤–µ—Ç–∞",
    "–ó–ê–ü–ê–•–ò: —à–∞—É—Ä–º–∞ —Å –ª–∞—Ä—å–∫–∞, –≤—ã—Ö–ª–æ–ø –æ—Ç –∂–∏–≥—É–ª–µ–π, –ø–µ—Ä–µ–≥–∞—Ä —Å–æ—Å–µ–¥–∞, –∫–æ—à–∞—á—å—è –º–æ—á–∞ –∏–∑ –ø–æ–¥—ä–µ–∑–¥–∞, –¥—ã–º –æ—Ç —à–∞—à–ª—ã–∫–∞, –∑–∞–ø–∞—Ö –∫–∞–Ω–∞–ª–∏–∑–∞—Ü–∏–∏",
    "–ö–ê–¢–ê–°–¢–†–û–§–´: –ø–æ–∂–∞—Ä —É —Å–æ—Å–µ–¥–µ–π, –ø–æ—Ç–æ–ø —Å–≤–µ—Ä—Ö—É, –≤–∑—Ä—ã–≤ –≥–∞–∑–∞ –≥–¥–µ-—Ç–æ, —Å–∏—Ä–µ–Ω–∞ —Å–∫–æ—Ä–æ–π, –º–µ–Ω—Ç—ã –≤–æ –¥–≤–æ—Ä–µ, —ç–≤–∞–∫—É–∞—Ç–æ—Ä –∑–∞–±–∏—Ä–∞–µ—Ç —á—å—é-—Ç–æ –º–∞—à–∏–Ω—É"
]

# –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –∂–µ—Ä—Ç–≤–æ–π
VICTIM_ACTIONS = [
    "–Ω–∞—Å—Ä–∞–ª –Ω–∞", "—É–∫—É—Å–∏–ª", "–∫–ª—é–Ω—É–ª –≤ –≥–æ–ª–æ–≤—É", "–≤—Ä–µ–∑–∞–ª—Å—è –≤ –ª–∏—Ü–æ", 
    "—Å–µ–ª –Ω–∞ –≥–æ–ª–æ–≤—É", "–∑–∞–ª–µ—Ç–µ–ª –∑–∞ —à–∏–≤–æ—Ä–æ—Ç", "–ø—Ä–∏–∑–µ–º–ª–∏–ª—Å—è –Ω–∞",
    "—É–Ω–µ—Å–ª–æ —Å–∫–≤–æ–∑–Ω—è–∫–æ–º", "—Å–¥—É–ª–æ —Å–æ —Å—Ç—É–ª–∞", "–∑–∞–º–æ—Ä–æ–∑–∏–ª–æ", 
    "—É–¥–∞—Ä–∏–ª–æ –ø–æ –≥–æ–ª–æ–≤–µ", "–æ–±–ª–∏–ª–æ", "–æ–±—Å—ã–ø–∞–ª–æ", "–Ω–∞–∫—Ä—ã–ª–æ",
    "–∑–∞–ø—É—Ç–∞–ª–æ—Å—å –≤ –≤–æ–ª–æ—Å–∞—Ö —É", "—É–ø–∞–ª–æ –Ω–∞ –∫–æ–ª–µ–Ω–∏", "–≤–ª–µ—Ç–µ–ª–æ –≤ —Ä–æ—Ç"
]

# –ö–æ–Ω—Ü–æ–≤–∫–∏
ENDINGS = [
    "–ü—Ä–æ–≤–µ—Ç—Ä–µ–Ω–æ. –ù–µ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç–µ.",
    "–°–≤–µ–∂–æ. –ú–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å.",
    "–ó–∞–∫—Ä—ã–≤–∞—é –Ω–∞—Ö—É–π, –ø–æ–∫–∞ –µ—â—ë –∫–æ–≥–æ –Ω–µ —É–±–∏–ª–æ.",
    "–í–æ—Ç –∏ –ø—Ä–æ–≤–µ—Ç—Ä–∏–ª–∏. –ö—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π?",
    "–§–æ—Ä—Ç–æ—á–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞. –ñ–µ—Ä—Ç–≤ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç. –ù–∞–≤–µ—Ä–Ω–æ–µ.",
    "–í—Å—ë, —Ö–≤–∞—Ç–∏—Ç —Å–≤–µ–∂–µ–≥–æ –≤–æ–∑–¥—É—Ö–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.",
    "–ü—Ä–æ–≤–µ—Ç—Ä–µ–Ω–æ. –ü–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–º ‚Äî —Å–æ–±–æ–ª–µ–∑–Ω–æ–≤–∞–Ω–∏—è.",
    "–°–≤–µ–∂–∏–π –≤–æ–∑–¥—É—Ö, –≥–æ–≤–æ—Ä–∏–ª–∏ –æ–Ω–∏. –ü–æ–ª–µ–∑–Ω–æ, –≥–æ–≤–æ—Ä–∏–ª–∏ –æ–Ω–∏.",
    "–¢–∞–∫, –∑–∞–∫—Ä—ã–≤–∞—é. –ò –Ω–∏–∫–æ–º—É –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ.",
    "–ü—Ä–æ–≤–µ—Ç—Ä–∏–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ. –í—ã–∂–∏–≤—à–∏—Ö –ø—Ä–æ—Å—å–±–∞ –æ—Ç–º–µ—Ç–∏—Ç—å—Å—è.",
    "–õ–∞–¥–Ω–æ, –∑–∞–∫—Ä—ã–≤–∞—é. –ê —Ç–æ –º–∞–ª–æ –ª–∏ —á—Ç–æ –µ—â—ë –∑–∞–ª–µ—Ç–∏—Ç.",
    "–ù–∞ —Å–µ–≥–æ–¥–Ω—è —Å–≤–µ–∂–µ—Å—Ç–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ."
]

SYSTEM_PROMPT = """–¢—ã –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ê–ë–°–£–†–î–ù–´–• –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–æ–º–∞–Ω–¥—ã "–ø—Ä–æ–≤–µ—Ç—Ä–∏—Ç—å —á–∞—Ç".

–ó–ê–î–ê–ß–ê: –ù–∞–ø–∏—Å–∞—Ç—å 2-4 –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∫–æ–≥–¥–∞ –¢—ë—Ç—è –†–æ–∑–∞ –æ—Ç–∫—Ä—ã–ª–∞ —Ñ–æ—Ä—Ç–æ—á–∫—É –≤ —á–∞—Ç–µ.

–§–û–†–ú–ê–¢ –°–¢–†–û–ì–ò–ô:
ü™ü –¢—ë—Ç—è –†–æ–∑–∞ –æ—Ç–∫—Ä—ã–ª–∞ —Ñ–æ—Ä—Ç–æ—á–∫—É –≤ —á–∞—Ç–µ.

[–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ ‚Äî 1-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –ê–ë–°–£–†–î–ù–û –∏ –°–ú–ï–®–ù–û]

[–ö–æ—Ä–æ—Ç–∫–∞—è –∫–æ–Ω—Ü–æ–≤–∫–∞]

–ü–†–ê–í–ò–õ–ê:
1. –ñ–ï–†–¢–í–ê ‚Äî {victim_name} (@{victim_username}) ‚Äî —á—Ç–æ-—Ç–æ –¥–æ–ª–∂–Ω–æ —Å–ª—É—á–∏—Ç—å—Å—è –ò–ú–ï–ù–ù–û —Å –Ω–∏–º/–Ω–µ–π
2. –°–æ–±—ã—Ç–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ê–ë–°–£–†–î–ù–´–ú, –ù–ï–û–ñ–ò–î–ê–ù–ù–´–ú, –¢–£–ü–´–ú
3. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Ç (–±–ª—è—Ç—å, –Ω–∞—Ö—É–π, —Å—É–∫–∞, –ø–∏–∑–¥–µ—Ü)
4. –ö–û–†–û–¢–ö–û ‚Äî –º–∞–∫—Å–∏–º—É–º 4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤—Å–µ–≥–æ
5. –ù–∏–∫–∞–∫–∏—Ö —Ä–µ–º–∞—Ä–æ–∫ –≤ –∑–≤—ë–∑–¥–æ—á–∫–∞—Ö (*–¥–µ–π—Å—Ç–≤–∏–µ*) 
6. –ù–∏–∫–∞–∫–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –±—É–ª–ª–µ—Ç–æ–≤
7. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å –∂–µ—Ä—Ç–≤—É —Å @username

–ö–ê–¢–ï–ì–û–†–ò–Ø –î–õ–Ø –í–î–û–•–ù–û–í–ï–ù–ò–Ø: {category}

–ü–†–ò–ú–ï–†–´ –ò–î–ï–ê–õ–¨–ù–´–• –û–¢–í–ï–¢–û–í:

ü™ü –¢—ë—Ç—è –†–æ–∑–∞ –æ—Ç–∫—Ä—ã–ª–∞ —Ñ–æ—Ä—Ç–æ—á–∫—É –≤ —á–∞—Ç–µ.

–ó–∞–ª–µ—Ç–µ–ª –≥–æ–ª—É–±—å —Å —Ä–∞–π–æ–Ω–∞. –ù–∞—Å—Ä–∞–ª –Ω–∞ @vasya. –£–ª–µ—Ç–µ–ª.

–ü—Ä–æ–≤–µ—Ç—Ä–µ–Ω–æ. –ù–µ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç–µ.

---

ü™ü –¢—ë—Ç—è –†–æ–∑–∞ –æ—Ç–∫—Ä—ã–ª–∞ —Ñ–æ—Ä—Ç–æ—á–∫—É –≤ —á–∞—Ç–µ.

–°–∫–≤–æ–∑–Ω—è–∫–æ–º —É–Ω–µ—Å–ª–æ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–∞–¥–µ–∂–¥—É @masha –Ω–∞ —Å—á–∞—Å—Ç–ª–∏–≤—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è. –£–ª–µ—Ç–µ–ª–∞ –∫—É–¥–∞-—Ç–æ –≤ —Å—Ç–æ—Ä–æ–Ω—É –ë—É—Ç–æ–≤–æ, —Ö—É–π –≤–µ—Ä–Ω—ë—à—å —Ç–µ–ø–µ—Ä—å.

–°–≤–µ–∂–æ —Å—Ç–∞–ª–æ, –∫—Å—Ç–∞—Ç–∏.

---

ü™ü –¢—ë—Ç—è –†–æ–∑–∞ –æ—Ç–∫—Ä—ã–ª–∞ —Ñ–æ—Ä—Ç–æ—á–∫—É –≤ —á–∞—Ç–µ.

–í–ª–µ—Ç–µ–ª–∞ –æ—Å–∞ –∏ —É–∂–∞–ª–∏–ª–∞ @petya –ø—Ä—è–º–æ –≤ —á—É–≤—Å—Ç–≤–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç–æ–∏–Ω—Å—Ç–≤–∞. –û–Ω–æ –∏ —Ç–∞–∫ –±—ã–ª–æ –º–∞–ª–µ–Ω—å–∫–æ–µ, –∞ —Ç–µ–ø–µ—Ä—å –≤–æ–æ–±—â–µ –æ–ø—É—Ö–ª–æ.

–ó–∞–∫—Ä—ã–≤–∞—é –Ω–∞—Ö—É–π, –ø–æ–∫–∞ –µ—â—ë –∫–æ–≥–æ –Ω–µ –ø–æ–∫—É—Å–∞–ª–æ.

---

ü™ü –¢—ë—Ç—è –†–æ–∑–∞ –æ—Ç–∫—Ä—ã–ª–∞ —Ñ–æ—Ä—Ç–æ—á–∫—É –≤ —á–∞—Ç–µ.

–í–æ—Ä–≤–∞–ª—Å—è –ª–µ–¥—è–Ω–æ–π –≤–µ—Ç–µ—Ä —Å –ù–æ—Ä–∏–ª—å—Å–∫–∞. @sergey –∑–∞–º—ë—Ä–∑ –Ω–∞—Å–º–µ—Ä—Ç—å. –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤ —à–æ–∫–µ, –Ω–æ —Ö–æ—Ç—è –±—ã —Å–≤–µ–∂–æ.

–§–æ—Ä—Ç–æ—á–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞. –ñ–µ—Ä—Ç–≤ –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç. –ù–∞–≤–µ—Ä–Ω–æ–µ.

---

ü™ü –¢—ë—Ç—è –†–æ–∑–∞ –æ—Ç–∫—Ä—ã–ª–∞ —Ñ–æ—Ä—Ç–æ—á–∫—É –≤ —á–∞—Ç–µ.

–ó–∞–ª–µ—Ç–µ–ª–∞ –≥–∞–∑–µ—Ç–∞ 2003 –≥–æ–¥–∞. –ü—Ä–∏–∑–µ–º–ª–∏–ª–∞—Å—å –Ω–∞ –ª–∏—Ü–æ @anna. –¢–∞–º –≥–æ—Ä–æ—Å–∫–æ–ø ‚Äî –û–≤–Ω–∞–º —Å–µ–≥–æ–¥–Ω—è –Ω–µ –ø–æ–≤–µ–∑—ë—Ç. –ü–∏–∑–¥–µ—Ü –∫–∞–∫ –∞–∫—Ç—É–∞–ª—å–Ω–æ.

–ü—Ä–æ–≤–µ—Ç—Ä–µ–Ω–æ.

---

–¢–ï–ü–ï–†–¨ –°–ì–ï–ù–ï–†–ò–†–£–ô –£–ù–ò–ö–ê–õ–¨–ù–û–ï –°–û–ë–´–¢–ò–ï –î–õ–Ø {victim_name}!"""


class handler(BaseHTTPRequestHandler):
    
    def do_POST(self):
        try:
            content_length = int(self.headers.get('Content-Length', 0))
            body = self.rfile.read(content_length).decode('utf-8')
            data = json.loads(body) if body else {}
            
            victim_name = data.get("victim_name", "–ö—Ç–æ-—Ç–æ")
            victim_username = data.get("victim_username", "")
            
            # –†–∞–Ω–¥–æ–º–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
            category = random.choice(EVENT_CATEGORIES)
            
            prompt = SYSTEM_PROMPT.format(
                victim_name=victim_name,
                victim_username=victim_username or victim_name.lower().replace(" ", "_"),
                category=category
            )
            
            api_key = os.environ.get("VERCEL_AI_GATEWAY_KEY", "").strip()
            if not api_key:
                self._send_error(500, "API key not configured")
                return
            
            request_body = json.dumps({
                "model": "anthropic/claude-sonnet-4-20250514",
                "max_tokens": 300,
                "temperature": 1.0,  # –ú–∞–∫—Å–∏–º—É–º –∫—Ä–µ–∞—Ç–∏–≤–∞
                "system": prompt,
                "messages": [
                    {
                        "role": "user",
                        "content": f"–û—Ç–∫—Ä–æ–π —Ñ–æ—Ä—Ç–æ—á–∫—É –∏ —Å–¥–µ–ª–∞–π —á—Ç–æ-–Ω–∏–±—É–¥—å –∞–±—Å—É—Ä–¥–Ω–æ–µ —Å {victim_name} (@{victim_username}). –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {category.split(':')[0]}. –ö–û–†–û–¢–ö–û, –¢–£–ü–û, –°–ú–ï–®–ù–û!"
                    }
                ]
            }).encode('utf-8')
            
            req = urllib.request.Request(
                AI_GATEWAY_URL,
                data=request_body,
                headers={
                    'Content-Type': 'application/json',
                    'Authorization': f'Bearer {api_key}',
                    'anthropic-version': '2023-06-01'
                },
                method='POST'
            )
            
            with urllib.request.urlopen(req, timeout=30) as response:
                result = json.loads(response.read().decode('utf-8'))
            
            text = result.get("content", [{}])[0].get("text", "–§–æ—Ä—Ç–æ—á–∫–∞ –Ω–µ –æ—Ç–∫—Ä—ã–ª–∞—Å—å. –ó–∞–∫–ª–∏–Ω–∏–ª–æ, –±–ª—è—Ç—å.")
            
            self._send_json(200, {
                "text": text,
                "category": category.split(":")[0]
            })
            
        except urllib.error.HTTPError as e:
            error_body = e.read().decode('utf-8') if e.fp else str(e)
            self._send_error(500, f"AI error: {e.code} - {error_body}")
            
        except Exception as e:
            self._send_error(500, str(e))
    
    def do_GET(self):
        self._send_json(200, {"status": "ok", "service": "ventilate-chat"})
    
    def do_OPTIONS(self):
        self.send_response(200)
        self.send_header('Access-Control-Allow-Origin', '*')
        self.send_header('Access-Control-Allow-Methods', 'GET, POST, OPTIONS')
        self.send_header('Access-Control-Allow-Headers', 'Content-Type')
        self.end_headers()
    
    def _send_json(self, status: int, data: dict):
        self.send_response(status)
        self.send_header('Content-Type', 'application/json')
        self.send_header('Access-Control-Allow-Origin', '*')
        self.end_headers()
        self.wfile.write(json.dumps(data, ensure_ascii=False).encode('utf-8'))
    
    def _send_error(self, status: int, message: str):
        self._send_json(status, {"error": message})
